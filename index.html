<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GPA Smart System</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="container">
<h1>ğŸ“ GPA Smart System</h1>
<div id="dashboard"></div>
<div id="levels"></div>
</div>

<script>

// ================== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ==================

const levelsNames = ["Ù…Ø³ØªÙˆÙ‰ 1","Ù…Ø³ØªÙˆÙ‰ 2","Ù…Ø³ØªÙˆÙ‰ 3","Ù…Ø³ØªÙˆÙ‰ 4"];

const semesterConfig = {
    "ÙØµÙ„ Ø£ÙˆÙ„": 6,
    "ÙØµÙ„ Ø«Ø§Ù†ÙŠ": 6,
    "ØµÙŠÙÙŠ": 3
};

const gradeScale = {
    "A+":4.0,"A":3.7,"A-":3.4,
    "B+":3.2,"B":3.0,"B-":2.8,
    "C+":2.6,"C":2.4,"C-":2.2,
    "D+":2.0,"D":1.5,"D-":1.0,
    "F":0.0
};

const gradePercentageMap = {
    "A+":98,"A":94,"A-":90,
    "B+":86,"B":82,"B-":78,
    "C+":74,"C":70,"C-":66,
    "D+":62,"D":57,"D-":52,
    "F":40
};

const gradeRangeMap = {
    "A+":"96% ÙØ£ÙƒØ«Ø±",
    "A":"92% â€“ Ø£Ù‚Ù„ Ù…Ù† 96%",
    "A-":"88% â€“ Ø£Ù‚Ù„ Ù…Ù† 92%",
    "B+":"84% â€“ Ø£Ù‚Ù„ Ù…Ù† 88%",
    "B":"80% â€“ Ø£Ù‚Ù„ Ù…Ù† 84%",
    "B-":"76% â€“ Ø£Ù‚Ù„ Ù…Ù† 80%",
    "C+":"72% â€“ Ø£Ù‚Ù„ Ù…Ù† 76%",
    "C":"68% â€“ Ø£Ù‚Ù„ Ù…Ù† 72%",
    "C-":"64% â€“ Ø£Ù‚Ù„ Ù…Ù† 68%",
    "D+":"60% â€“ Ø£Ù‚Ù„ Ù…Ù† 64%",
    "D":"55% â€“ Ø£Ù‚Ù„ Ù…Ù† 60%",
    "D-":"50% â€“ Ø£Ù‚Ù„ Ù…Ù† 55%",
    "F":"Ø£Ù‚Ù„ Ù…Ù† 50%"
};

const gradeStatusMap = {
    "A+": "Ø§Ù…ØªÙŠØ§Ø² Ù…Ø±ØªÙØ¹",
    "A": "Ø§Ù…ØªÙŠØ§Ø²",
    "A-": "Ø§Ù…ØªÙŠØ§Ø² Ù…Ù†Ø®ÙØ¶",
    "B+": "Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§ Ù…Ø±ØªÙØ¹",
    "B": "Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§",
    "B-": "Ø¬ÙŠØ¯ Ø¬Ø¯Ù‹Ø§ Ù…Ù†Ø®ÙØ¶",
    "C+": "Ø¬ÙŠØ¯ Ù…Ø±ØªÙØ¹",
    "C": "Ø¬ÙŠØ¯",
    "C-": "Ø¬ÙŠØ¯ Ù…Ù†Ø®ÙØ¶",
    "D+": "Ù…Ù‚Ø¨ÙˆÙ„ Ù…Ø±ØªÙØ¹",
    "D": "Ù…Ù‚Ø¨ÙˆÙ„",
    "D-": "Ù…Ù‚Ø¨ÙˆÙ„ Ù…Ù†Ø®ÙØ¶",
    "F": "Ø±Ø§Ø³Ø¨"
};

let data = JSON.parse(localStorage.getItem("gpaFinalV2")) || {};

// ================== ØªÙ‡ÙŠØ¦Ø© ==================

function init(){
    levelsNames.forEach(level=>{
        if(!data[level]) data[level]={};

        Object.keys(semesterConfig).forEach(sem=>{
            if(!data[level][sem]) data[level][sem]=[];

            while(data[level][sem].length < semesterConfig[sem]){
                data[level][sem].push({name:"",hours:"",grade:""});
            }
        });
    });

    save();
}

function save(){
    localStorage.setItem("gpaFinalV2", JSON.stringify(data));
}

// ================== Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© ==================

function addSubject(level,sem){
    data[level][sem].push({name:"",hours:"",grade:""});
    render();
}

// ================== Ø£Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø© ÙÙ‚Ø· ==================

function getAllUniqueSubjects(){
    let map={};

    levelsNames.forEach(level=>{
        Object.keys(semesterConfig).forEach(sem=>{
            data[level][sem].forEach(sub=>{
                if(sub.name && sub.hours && sub.grade){
                    if(!map[sub.name]) map[sub.name]=[];
                    map[sub.name].push(sub);
                }
            });
        });
    });

    return map;
}

// ================== ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ==================

function getFinalLetter(gpa){
    if(gpa >= 3.7) return "A+";
    if(gpa >= 3.4) return "A";
    if(gpa >= 3.2) return "A-";
    if(gpa >= 3.0) return "B+";
    if(gpa >= 2.8) return "B";
    if(gpa >= 2.6) return "B-";
    if(gpa >= 2.4) return "C+";
    if(gpa >= 2.2) return "C";
    if(gpa >= 2.0) return "C-";
    if(gpa >= 1.5) return "D+";
    if(gpa >= 1.0) return "D";
    if(gpa > 0) return "D-";
    return "F";
}

// ================== Ø§Ù„Ø­Ø³Ø§Ø¨ ==================

function calculateStats(){

    let map=getAllUniqueSubjects();

    let totalPoints=0;
    let totalHours=0;
    let totalPercentage=0;

    Object.values(map).forEach(attempts=>{

        let best=attempts.reduce((max,cur)=>
            gradeScale[cur.grade] > gradeScale[max.grade] ? cur : max
        );

        totalPoints += parseFloat(best.hours) * gradeScale[best.grade];
        totalHours += parseFloat(best.hours);
        totalPercentage += parseFloat(best.hours) * gradePercentageMap[best.grade];
    });

    let gpa = totalHours ? totalPoints/totalHours : 0;
    let percentage = totalHours ? totalPercentage/totalHours : 0;

    let letter=getFinalLetter(gpa);

    return {
        gpa:gpa.toFixed(2),
        percentage:percentage.toFixed(2),
        hours:totalHours,
        points:totalPoints.toFixed(2),
        letter:letter,
        range:gradeRangeMap[letter]
    };
}

// ================== Ø§Ù„Ø¹Ø±Ø¶ ==================

function render(){

    let stats=calculateStats();
    let allSubjects=getAllUniqueSubjects();

    document.getElementById("dashboard").innerHTML=`
    <div class="dashboard-box">
    ğŸ“ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ: <b>${stats.gpa}</b> |
    ğŸ… Ø§Ù„ØªÙ‚Ø¯ÙŠØ±: <b>${stats.letter}</b><br>
    ğŸ“Š Ø§Ù„Ù†Ø³Ø¨Ø©: <b>${stats.percentage}%</b><br>
    ğŸ“Œ Ø§Ù„Ø±ÙŠÙ†Ø¬ Ø§Ù„Ø±Ø³Ù…ÙŠ: <b>${stats.range}</b><br><br>
    ğŸ“š Ø§Ù„Ø³Ø§Ø¹Ø§Øª: <b>${stats.hours}</b> |
    â­ Ø§Ù„Ù†Ù‚Ø§Ø·: <b>${stats.points}</b>
    </div>`;

    let html="";

    levelsNames.forEach((level,i)=>{

        html+=`<div class="level-card level-${i+1}">
        <h3>${level}</h3>`;

        Object.keys(semesterConfig).forEach(sem=>{

            html+=`<div class="semester"><h4>${sem}</h4>`;

            // ØµÙ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
            html+=`
            <div class="subject-header">
                <div class="col-name">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</div>
                <div class="col-hours">Ø³</div>
                <div class="col-grade">Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</div>
                <div class="col-points">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                <div class="col-status">Ø§Ù„Ø­Ø§Ù„Ø©</div>
                <div class="col-attempts">Ù…Ø±Ø§Øª</div>
            </div>
            `;

            data[level][sem].forEach((sub,index)=>{

                let attempts = sub.name && allSubjects[sub.name] ? allSubjects[sub.name].length : "";

                html+=`
                <div class="subject-row">

                <input class="subject-name"
                placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©"
                value="${sub.name}"
                onchange="data['${level}']['${sem}'][${index}].name=this.value;save();render();">

                <input class="subject-hours"
                type="number"
                placeholder="Ø³"
                value="${sub.hours}"
                onchange="data['${level}']['${sem}'][${index}].hours=this.value;save();render();">

                <select class="subject-grade"
                onchange="data['${level}']['${sem}'][${index}].grade=this.value;save();render();">
                <option value="">--</option>
                ${Object.keys(gradeScale).map(g=>
                `<option value="${g}" ${sub.grade===g?"selected":""}>${g}</option>`
                ).join("")}
                </select>

                <input class="subject-points"
                value="${sub.grade && sub.hours ? (sub.hours * gradeScale[sub.grade]).toFixed(2) : ''}"
                readonly>

                <input class="subject-status status-${sub.grade ? sub.grade.replace('+','plus').replace('-','minus') : ''}"
                value="${sub.grade ? gradeStatusMap[sub.grade] : ''}"
                readonly>

                <input class="subject-attempts"
                value="${attempts}"
                readonly>

                </div>`;
            });

            html+=`
            <button class="add-btn"
            onclick="addSubject('${level}','${sem}')">
            â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©
            </button>
            </div>`;
        });

        html+=`</div>`;
    });

    document.getElementById("levels").innerHTML=html;
}
 

init();
render();

</script>

</body>
</html>
